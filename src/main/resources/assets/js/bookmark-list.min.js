"use strict";function main(){var e=document.getElementById("bookmark__top-menu"),t=document.querySelectorAll("[data-content-id]");e&&t&&(addGetChildrenEventListener(),checkBoxEventListener(),addRemoveBookmarkEventListener())}function addGetChildrenEventListener(){var e=document.getElementById("bookmark__top-menu"),t=e.getAttribute("data-bookmark-service-url"),n=e.getAttribute("data-repository-id"),a=e.getAttribute("data-branch"),c=document.querySelectorAll("[data-content-id].expandable");c.length&&c.forEach(function(e){e.classList.contains("expandable")&&e.addEventListener("click",function(){return getChildrenEventListener({bookmarkServiceURL:t,branch:a,repositoryId:n,item:e})})})}function addRemoveBookmarkEventListener(){var e=document.getElementById("removeSelection"),t=document.getElementById("bookmark__top-menu").getAttribute("data-bookmark-service-url");e.addEventListener("click",function(){var n=document.querySelectorAll(".item-wrapper label.checked"),a=[];n.length&&(n.forEach(function(e){return a.push(e.getAttribute("id"))}),fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"unfavorite",contentIds:a})}).then(function(e){return e.json()}).then(function(t){t&&t._id&&(n.forEach(function(e){a.some(function(t){return t===e.getAttribute("id")})&&e.closest(".item").remove()}),document.querySelectorAll(".item-wrapper label.checked").length||e.classList.add("disabled"))}))})}function updateBookmarkTree(){var e=document.getElementById("bookmark__top-menu"),t=e.getAttribute("data-bookmark-service-url"),n=e.getAttribute("data-repository-id"),a=e.getAttribute("data-branch");fetch(t+"?repositoryId=".concat(n,"&branch=").concat(a,"&action=get-all")).then(function(e){return e.json()}).then(function(e){var t=document.querySelector(".bookmark-list");t.innerHTML="";var n=buildBookmarkTree(e);t.insertAdjacentElement("beforeend",n)})}function checkBoxEventListener(){var e=document.querySelectorAll(".item-wrapper label"),t=document.querySelector("#checkAll"),n=document.querySelector("#removeSelection");function a(){var t=!1;return e.forEach(function(e){e.classList.contains("checked")&&(t=!0)}),t}e.forEach(function(e){e.addEventListener("click",function(c){c.preventDefault(),t.classList.contains("checked")&&e.classList.contains("checked")&&t.classList.remove("checked"),e.classList.toggle("checked"),a()?n.classList.remove("disabled"):n.classList.add("disabled")})}),t.addEventListener("click",function(c){c.preventDefault(),t.classList.contains("checked")?(t.classList.remove("checked"),e.forEach(function(e){e.classList.contains("checked")&&e.classList.remove("checked")})):(t.classList.add("checked"),e.forEach(function(e){e.classList.contains("checked")||e.classList.add("checked")}),n.classList.remove("disabled")),a()?n.classList.remove("disabled"):n.classList.add("disabled")})}function getChildrenEventListener(e){var t=e.bookmarkServiceURL,n=e.branch,a=e.repositoryId,c=e.item,r=c.getAttribute("data-content-id");c.classList.contains("expanded")?(c.classList.remove("expanded"),c.parentElement.parentElement.querySelector(".bookmark-sublist").remove()):fetch(t+"?contentId=".concat(r,"&repositoryId=").concat(a,"&branch=").concat(n,"&action=get-children")).then(function(e){return e.json()}).then(function(e){var t=buildBookmarkTree(e);c.parentElement.parentElement.insertAdjacentElement("beforeend",t),c.classList.add("expanded")})}function buildBookmarkTree(e){var t=document.getElementById("bookmark__top-menu"),n=t.getAttribute("data-bookmark-service-url"),a=t.getAttribute("data-repository-id"),c=t.getAttribute("data-branch"),r=document.createElement("div");return r.classList.add("bookmark-sublist"),e.forEach(function(e){var t=document.createElement("div");t.classList.add("item");var o=document.createElement("div");o.classList.add("item-wrapper"),t.appendChild(o);var i=document.createElement("div");i.classList.add("toggle","icon","expand"),e.hasChildren&&(i.setAttribute("data-content-id",e._id),i.classList.add("expandable"),i.addEventListener("click",function(){return getChildrenEventListener({bookmarkServiceURL:n,branch:c,repositoryId:a,item:i})}));var d=document.createElement("a");d.href=e.link,d.target="_blank",d.classList.add("item-info"),o.appendChild(i),o.appendChild(d);var s=document.createElement("img");s.src=e.icon,s.width=32,s.height=32;var l=document.createElement("div");l.classList.add("content-info"),d.appendChild(s),d.appendChild(l);var u=document.createElement("strong");u.textContent=e.displayName;var m=document.createElement("p");m.textContent=e._path,l.appendChild(u),l.appendChild(m),r.appendChild(t)}),r}main();